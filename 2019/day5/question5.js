const getDataAddress = (memory, index, mode) =>
  mode === "1" ? index : memory[index];

const getDataIndices = (memory, index, instruction) => {
  const A = getDataAddress(memory, index + 1, instruction.parm1Mode);
  const B = getDataAddress(memory, index + 2, instruction.parm2Mode);
  const res = getDataAddress(memory, index + 3, instruction.parm3Mode);
  return [A, B, res];
};

const sum = (memory, index, instruction) => {
  const [A, B, res] = getDataIndices(memory, index, instruction);
  memory[res] = memory[A] + memory[B];
  return index + 4;
};

const mul = (memory, index, instruction) => {
  const [A, B, res] = getDataIndices(memory, index, instruction);
  memory[res] = memory[A] * memory[B];
  return index + 4;
};

const ip = (memory, index) => {
  const writeAddress = memory[index + 1];
  memory[writeAddress] = parseInt(prompt("Enter Input"));
  return index + 2;
};

const op = (memory, index, instruction) => {
  const output = getDataAddress(memory, index + 1, instruction.parm1Mode);
  console.log(memory[output]);
  return index + 2;
};

const jmpIfTrue = (memory, index, instruction) => {
  const [A, B] = getDataIndices(memory, index, instruction);
  return memory[A] !== 0 ? memory[B] : index + 3;
};

const jmpIfFalse = (memory, index, instruction) => {
  const [A, B] = getDataIndices(memory, index, instruction);
  return memory[A] === 0 ? memory[B] : index + 3;
};

const lessThan = (memory, index, instruction) => {
  const [A, B, res] = getDataIndices(memory, index, instruction);
  memory[res] = memory[A] < memory[B] ? 1 : 0;
  return index + 4;
};

const equalTo = (memory, index, instruction) => {
  const [A, B, res] = getDataIndices(memory, index, instruction);
  memory[res] = memory[A] === memory[B] ? 1 : 0;
  return index + 4;
};

const parseInstruction = (instruction) => {
  const [parm3Mode, parm2Mode, parm1Mode, ...opcode] = instruction.toString()
    .padStart(5, "0").split("");
  return { parm3Mode, parm2Mode, parm1Mode, opCode: opcode.join("") };
};

const actions = {
  "01": sum,
  "02": mul,
  "03": ip,
  "04": op,
  "05": jmpIfTrue,
  "06": jmpIfFalse,
  "07": lessThan,
  "08": equalTo,
  // "99": 
}

const main = (memory) => {
  let index = 0;
  while (index < memory.length && memory[index] !== 99) {
    const instruction = parseInstruction(memory[index]);
    index = actions[instruction.opCode](memory, index, instruction);
  }
  return memory;
}

// const main = (memory) => {
//   let index = 0;
//   while (index < memory.length) {
//     const instruction = parseInstruction(memory[index]);
//     // console.log(instruction)
//     switch (instruction.opCode) {
//       case "01":
//         index = sum(memory, index, instruction);
//         break;
//       case "02":
//         index = mul(memory, index, instruction);
//         break;
//       case "03":
//         index = ip(memory, index, instruction);
//         break;
//       case "04":
//         index = op(memory, index, instruction);
//         break;
//       case "05":
//         index = jmpIfTrue(memory, index, instruction);
//         break;
//       case "06":
//         index = jmpIfFalse(memory, index, instruction);
//         break;
//       case "07":
//         index = lessThan(memory, index, instruction);
//         break;
//       case "08":
//         index = equalTo(memory, index, instruction);
//         break;
//       case "99":
//         console.log("Halted");
//         // console.log(memory);
//         return memory;
//       default:
//         console.log("is corrpeted data", instruction.opCode);
//         index += 1;
//         break;
//     }
//   }
//   return memory;
// };

// const input = [
//   3,
//   225,
//   1,
//   225,
//   6,
//   6,
//   1100,
//   1,
//   238,
//   225,
//   104,
//   0,
//   1102,
//   59,
//   58,
//   224,
//   1001,
//   224,
//   -3422,
//   224,
//   4,
//   224,
//   102,
//   8,
//   223,
//   223,
//   101,
//   3,
//   224,
//   224,
//   1,
//   224,
//   223,
//   223,
//   1101,
//   59,
//   30,
//   225,
//   1101,
//   53,
//   84,
//   224,
//   101,
//   -137,
//   224,
//   224,
//   4,
//   224,
//   1002,
//   223,
//   8,
//   223,
//   101,
//   3,
//   224,
//   224,
//   1,
//   223,
//   224,
//   223,
//   1102,
//   42,
//   83,
//   225,
//   2,
//   140,
//   88,
//   224,
//   1001,
//   224,
//   -4891,
//   224,
//   4,
//   224,
//   1002,
//   223,
//   8,
//   223,
//   1001,
//   224,
//   5,
//   224,
//   1,
//   223,
//   224,
//   223,
//   1101,
//   61,
//   67,
//   225,
//   101,
//   46,
//   62,
//   224,
//   1001,
//   224,
//   -129,
//   224,
//   4,
//   224,
//   1002,
//   223,
//   8,
//   223,
//   101,
//   5,
//   224,
//   224,
//   1,
//   223,
//   224,
//   223,
//   1102,
//   53,
//   40,
//   225,
//   1001,
//   35,
//   35,
//   224,
//   1001,
//   224,
//   -94,
//   224,
//   4,
//   224,
//   102,
//   8,
//   223,
//   223,
//   101,
//   6,
//   224,
//   224,
//   1,
//   223,
//   224,
//   223,
//   1101,
//   5,
//   73,
//   225,
//   1002,
//   191,
//   52,
//   224,
//   1001,
//   224,
//   -1872,
//   224,
//   4,
//   224,
//   1002,
//   223,
//   8,
//   223,
//   1001,
//   224,
//   5,
//   224,
//   1,
//   223,
//   224,
//   223,
//   102,
//   82,
//   195,
//   224,
//   101,
//   -738,
//   224,
//   224,
//   4,
//   224,
//   1002,
//   223,
//   8,
//   223,
//   1001,
//   224,
//   2,
//   224,
//   1,
//   224,
//   223,
//   223,
//   1101,
//   83,
//   52,
//   225,
//   1101,
//   36,
//   77,
//   225,
//   1101,
//   9,
//   10,
//   225,
//   1,
//   113,
//   187,
//   224,
//   1001,
//   224,
//   -136,
//   224,
//   4,
//   224,
//   1002,
//   223,
//   8,
//   223,
//   101,
//   2,
//   224,
//   224,
//   1,
//   224,
//   223,
//   223,
//   4,
//   223,
//   99,
//   0,
//   0,
//   0,
//   677,
//   0,
//   0,
//   0,
//   0,
//   0,
//   0,
//   0,
//   0,
//   0,
//   0,
//   0,
//   1105,
//   0,
//   99999,
//   1105,
//   227,
//   247,
//   1105,
//   1,
//   99999,
//   1005,
//   227,
//   99999,
//   1005,
//   0,
//   256,
//   1105,
//   1,
//   99999,
//   1106,
//   227,
//   99999,
//   1106,
//   0,
//   265,
//   1105,
//   1,
//   99999,
//   1006,
//   0,
//   99999,
//   1006,
//   227,
//   274,
//   1105,
//   1,
//   99999,
//   1105,
//   1,
//   280,
//   1105,
//   1,
//   99999,
//   1,
//   225,
//   225,
//   225,
//   1101,
//   294,
//   0,
//   0,
//   105,
//   1,
//   0,
//   1105,
//   1,
//   99999,
//   1106,
//   0,
//   300,
//   1105,
//   1,
//   99999,
//   1,
//   225,
//   225,
//   225,
//   1101,
//   314,
//   0,
//   0,
//   106,
//   0,
//   0,
//   1105,
//   1,
//   99999,
//   1007,
//   226,
//   226,
//   224,
//   1002,
//   223,
//   2,
//   223,
//   1006,
//   224,
//   329,
//   1001,
//   223,
//   1,
//   223,
//   1108,
//   226,
//   226,
//   224,
//   102,
//   2,
//   223,
//   223,
//   1006,
//   224,
//   344,
//   101,
//   1,
//   223,
//   223,
//   1007,
//   677,
//   677,
//   224,
//   102,
//   2,
//   223,
//   223,
//   1006,
//   224,
//   359,
//   101,
//   1,
//   223,
//   223,
//   1108,
//   677,
//   226,
//   224,
//   1002,
//   223,
//   2,
//   223,
//   1005,
//   224,
//   374,
//   1001,
//   223,
//   1,
//   223,
//   7,
//   677,
//   226,
//   224,
//   102,
//   2,
//   223,
//   223,
//   1005,
//   224,
//   389,
//   1001,
//   223,
//   1,
//   223,
//   1008,
//   677,
//   677,
//   224,
//   1002,
//   223,
//   2,
//   223,
//   1005,
//   224,
//   404,
//   101,
//   1,
//   223,
//   223,
//   108,
//   226,
//   226,
//   224,
//   1002,
//   223,
//   2,
//   223,
//   1006,
//   224,
//   419,
//   101,
//   1,
//   223,
//   223,
//   1008,
//   226,
//   677,
//   224,
//   1002,
//   223,
//   2,
//   223,
//   1006,
//   224,
//   434,
//   1001,
//   223,
//   1,
//   223,
//   1107,
//   677,
//   226,
//   224,
//   1002,
//   223,
//   2,
//   223,
//   1005,
//   224,
//   449,
//   101,
//   1,
//   223,
//   223,
//   1008,
//   226,
//   226,
//   224,
//   102,
//   2,
//   223,
//   223,
//   1005,
//   224,
//   464,
//   1001,
//   223,
//   1,
//   223,
//   8,
//   226,
//   226,
//   224,
//   1002,
//   223,
//   2,
//   223,
//   1006,
//   224,
//   479,
//   1001,
//   223,
//   1,
//   223,
//   107,
//   226,
//   677,
//   224,
//   102,
//   2,
//   223,
//   223,
//   1005,
//   224,
//   494,
//   1001,
//   223,
//   1,
//   223,
//   7,
//   226,
//   226,
//   224,
//   102,
//   2,
//   223,
//   223,
//   1005,
//   224,
//   509,
//   1001,
//   223,
//   1,
//   223,
//   107,
//   226,
//   226,
//   224,
//   102,
//   2,
//   223,
//   223,
//   1005,
//   224,
//   524,
//   101,
//   1,
//   223,
//   223,
//   107,
//   677,
//   677,
//   224,
//   1002,
//   223,
//   2,
//   223,
//   1006,
//   224,
//   539,
//   101,
//   1,
//   223,
//   223,
//   8,
//   677,
//   226,
//   224,
//   1002,
//   223,
//   2,
//   223,
//   1006,
//   224,
//   554,
//   101,
//   1,
//   223,
//   223,
//   1107,
//   677,
//   677,
//   224,
//   1002,
//   223,
//   2,
//   223,
//   1005,
//   224,
//   569,
//   101,
//   1,
//   223,
//   223,
//   108,
//   226,
//   677,
//   224,
//   1002,
//   223,
//   2,
//   223,
//   1006,
//   224,
//   584,
//   101,
//   1,
//   223,
//   223,
//   7,
//   226,
//   677,
//   224,
//   1002,
//   223,
//   2,
//   223,
//   1005,
//   224,
//   599,
//   1001,
//   223,
//   1,
//   223,
//   8,
//   226,
//   677,
//   224,
//   102,
//   2,
//   223,
//   223,
//   1006,
//   224,
//   614,
//   1001,
//   223,
//   1,
//   223,
//   108,
//   677,
//   677,
//   224,
//   1002,
//   223,
//   2,
//   223,
//   1006,
//   224,
//   629,
//   1001,
//   223,
//   1,
//   223,
//   1007,
//   226,
//   677,
//   224,
//   1002,
//   223,
//   2,
//   223,
//   1006,
//   224,
//   644,
//   101,
//   1,
//   223,
//   223,
//   1108,
//   226,
//   677,
//   224,
//   102,
//   2,
//   223,
//   223,
//   1005,
//   224,
//   659,
//   1001,
//   223,
//   1,
//   223,
//   1107,
//   226,
//   677,
//   224,
//   102,
//   2,
//   223,
//   223,
//   1006,
//   224,
//   674,
//   1001,
//   223,
//   1,
//   223,
//   4,
//   223,
//   99,
//   226,
// ];

const smallData = [
  3,
  21,
  1008,
  21,
  8,
  20,
  1005,
  20,
  22,
  107,
  8,
  21,
  20,
  1006,
  20,
  31,
  1106,
  0,
  36,
  98,
  0,
  0,
  1002,
  21,
  125,
  20,
  4,
  20,
  1105,
  1,
  46,
  104,
  999,
  1105,
  1,
  46,
  1101,
  1000,
  1,
  20,
  4,
  20,
  1105,
  1,
  46,
  98,
  99,
];

// const example1 = [
//   3,
//   21,
//   1008,
//   21,
//   8,
//   20,
//   1005,
//   20,
//   22,
//   107,
//   8,
//   21,
//   20,
//   1006,
//   20,
//   31,
//   1106,
//   0,
//   36,
//   98,
//   0,
//   0,
//   1002,
//   21,
//   125,
//   20,
//   4,
//   20,
//   1105,
//   1,
//   46,
//   104,
//   999,
//   1105,
//   1,
//   46,
//   1101,
//   1000,
//   1,
//   20,
//   4,
//   20,
//   1105,
//   1,
//   46,
//   98,
//   99,
// ];
main(smallData);
